<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    // 2-1. í”„ë¡œë¯¸ìŠ¤
    // "ê²°ê³¼ë¥¼ ì•½ì†í•©ë‹ˆë‹¤!"
    // ì˜ˆ:(ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ê°™ì€ ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ë¡œì§ì„ í†µí•´) ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ë©´ ê·¸ ë•Œ ë„¤ê°€ ë“±ë¡í•œ ì½œë°± í•¨ìˆ˜ë¥¼ ì•½ì†í• ê²Œ~~~~~~~~~~~
    // ë¹„ë™ê¸°ë¥¼ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ê°ì²´ì´ë‹¤.(ì½œë°±ì„ ëŒ€ì²´í•˜ì—¬ ë¹„ë™ê¸° ì²˜ë¦¬ í‘œì¤€ìœ¼ë¡œ ì“°ì„)
    // - ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê³  ë‚˜ì„œ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œëë‹¤ë©´ ì²˜ë¦¬ëœ ê²°ê³¼ê°’ì„ ì „ë‹¬
    // - ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì—ëŸ¬ë¥¼ ì „ë‹¬í•´ì¤Œ

    // (ì°¸ê³ ) í”„ë¡œë¯¸ìŠ¤ì˜ 3ê°€ì§€ ê°œë…
    // 1) PromiseState - í”„ë¡œë¯¸ìŠ¤ì˜ ìƒíƒœ. ê¸°ëŠ¥ì„ ìˆ˜í–‰ì¤‘ì¸ì§€, ì™„ë£ŒëëŠ”ì§€(ì™„ë£Œëë‹¤ë©´ ì„±ê³µì¸ì§€ ì‹¤íŒ¨ì¸ì§€)ì— ëŒ€í•œ ìƒíƒœ
    // pending(í”„ë¡œë¯¸ìŠ¤ê°€ ë§Œë“¤ì–´ì ¸ì„œ ê¸°ëŠ¥ì„ ìˆ˜í–‰ì¤‘ ì¼ ë•Œ) 
    //   -> ì„±ê³µ ì‹œ resolve() í˜¸ì¶œ -> fulfilled(ì„±ê³µì ìœ¼ë¡œ ë‹¤ ëëƒˆì„ ë•Œ)
    //   -> ì‹¤íŒ¨ ì‹œ reject() í˜¸ì¶œ -> rejected(ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ)

    // 2) PromiseResult - í”„ë¡œë¯¸ìŠ¤ ìƒíƒœì— ë”°ë¥¸ ê²°ê³¼
    // "ìƒíƒœ" -> ê²°ê³¼
    // "pending" -> undefined
    // "fulfilled" -> ìš°ë¦¬ê°€ ë„˜ê¸´ ê²°ê³¼ê°’
    // "rejected" -> ì¼ë°˜ì ìœ¼ë¡œ Error ê°ì²´

    // 3) Producing code - ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œ í›„ í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ì½”ë“œ(ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆëŠ” ì½”ë“œ)
    //    Consuming code - ë°›ì€ ë°ì´í„°ë¥¼ ì†Œë¹„í•˜ëŠ” ì½”ë“œ(ê²°ê³¼ë¥¼ ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ” ì½”ë“œ)
    
    // ì •ë¦¬: í”„ë¡œë¯¸ìŠ¤ëŠ” "Producing code"ì™€ "Consuming code"ë¥¼ ì—°ê²°í•˜ê³  ìµœì¢… ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´

    // í”„ë¡œë¯¸ìŠ¤ ê°ì²´ ë§Œë“¤ê¸°
    // ë³€ìˆ˜ = new Promise(í•¨ìˆ˜(resolve, reject));
    // resolve(): ê¸°ëŠ¥ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•´ì„œ ìµœì¢… ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” í•¨ìˆ˜
    // reject(): ê¸°ëŠ¥ ìˆ˜í–‰ ì¤‘ ë¬¸ì œê°€ ìƒê¸°ë©´ í˜¸ì¶œí•˜ê²Œ ë  í•¨ìˆ˜

    // í”„ë¡œë¯¸ìŠ¤ ì˜ˆì œ1
    const myPromise = new Promise((resolve, reject) => {
      // ë¹„ë™ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê³  ì‹¶ì€ ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‘ì„±
      console.log('ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì‘ì—… ë˜ëŠ” íŒŒì¼ì„ ì½ëŠ” ì‘ì—…ì„ ìˆ˜í–‰ì¤‘...');
      // í”„ë¡œë¯¸ìŠ¤ ê°ì²´ê°€ ìƒì„±ë˜ê³  ë°”ë¡œ ì½œë°± í•¨ìˆ˜ê°€ ì‹¤í–‰ë¨

      setTimeout(() => {
        const resultFlag = true; // í…ŒìŠ¤íŠ¸ìš©

        // ì„±ê³µ ì‹œ resolve(), ì‹¤íŒ¨ ì‹œ reject() ë‘ ì½œë°± ì¤‘ í•˜ë‚˜ë¥¼ í˜¸ì¶œí•´ì•¼ í•¨(ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ promise í•¨ìˆ˜ê°€ ëì´ ë‚˜ì§€ ì•ŠìŒ)
        if (resultFlag) {
          resolve('ê¸°ëŠ¥ ìˆ˜í–‰ í›„ ì–»ì€ ë°ì´í„° ğŸƒ'); // ì„±ê³µì ì„ ê²°ê³¼ë¥¼ ê°€ì ¸ì™”ë‹¤ë©´ resolve(data*) í˜¸ì¶œ
        } else {                                                                       //
          reject(new Error('ì—ëŸ¬ ë°œìƒğŸ‡!!'));  // ì‹¤íŒ¨í–ˆë‹¤ë©´ reject(err*) í˜¸ì¶œ           //
        }                                                            //                  //
      }, 2000);                                                       //                  //
    });                                                                 //                  //
                                                                          //                  //
    myPromise                                                              //                   //
      .then((data) => { // ìœ„ì—ì„œ ë§Œë“  í”„ë¡œë¯¸ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì˜ ìˆ˜í–‰ì´ ëœë‹¤ë©´(ì„±ê³µ ì‹œ) then (ê·¸ëŸ¬ë©´) data* ë¥¼ ë°›ì•„ì™€ì„œ ì²˜ë¦¬
        console.log(data);                                                 //
      })                                                                    //
      .catch((err) => { // ìœ„ì—ì„œ ë§Œë“  í”„ë¡œë¯¸ìŠ¤ì— ë¬¸ì œê°€ ë°œìƒí•œë‹¤ë©´(ì‹¤íŒ¨ ì‹œ) err** ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬
        console.log(err);
      })
      .finally(() => { // (ì˜µì…”ë„) ì„±ê³µ/ì‹¤íŒ¨ì™€ ìƒê´€ì—†ì´ ë¬´ì¡°ê±´ ì‹¤í–‰
        console.log('ë§ˆì§€ë§‰ì— ë¬´ì¡°ê±´ ì‹¤í–‰');
      });

    // í”„ë¡œë¯¸ìŠ¤ ê°ì²´ í™•ì¸ìš© ë¡œê·¸
    // console.log(myPromise);
    // setTimeout(() => {
    //   console.log(myPromise);
    // }, 2000);

    // ì •ë¦¬:
    // í”„ë¡œë¯¸ìŠ¤ê°€ ì„±ê³µí•  ë•Œì˜ ê°’ì„ ì–»ëŠ” ë° then()ì„ ì‚¬ìš©
    // í”„ë¡œë¯¸ìŠ¤ê°€ ì‹¤íŒ¨í•  ë•Œì˜ ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•˜ëŠ”ë° catch()ë¥¼ ì‚¬ìš©

    // í”„ë¡œë¯¸ìŠ¤ ì˜ˆì œ2
    // fetch()ë¥¼ ì‚¬ìš©í•œ API í˜¸ì¶œ
    // fetch()ëŠ” ì„œë²„ì—ì„œ ê²°ê³¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•˜ê³  ê·¸ ê²°ê³¼ë¡œ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜
    // ì„±ê³µ ì‹œ resolve(Response ê°ì²´); ë¥¼ í•´ì¤Œ
    
    // fetch() ê¸°ë³¸ ë¬¸ë²•
    // fetch(url, [option]); [option]ì€ í•„ìˆ˜ê°€ ì•„ë‹˜
    // url: ì ‘ê·¼í•˜ê³ ì í•˜ëŠ” API URL (ì„œë²„ ì£¼ì†Œ)
    // option: method, header ë“±ì„ ì§€ì •í•  ìˆ˜ ìˆìŒ

    // ê¸°ë³¸ ì‚¬ìš©ë²•
    // fetch('api-url')
    // .then((res) => { //res: Response ê°ì²´ 
    //   return res.json(); // json() ë©”ì†Œë“œ: ì‘ë‹µì„ íŒŒì‹±í•´ JS ê°ì²´ë¡œ ë³€í™˜
    // }) //     // ê°™ì€ê±°ì„
    // .then((data) => {
    //   // dataë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬
    // });

    fetch('https://jsonplaceholder.typicode.com/posts')
    .then((res) => {
      console.log(res);
      return res.json();
    })
    .then((data) => {
      console.log(data);
    });

    // 2-2. í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹
    // í”„ë¡œë¯¸ìŠ¤ ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨ ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ
    // ì´ì „ í”„ë¡œë¯¸ìŠ¤ì—ì„œ ë°˜í™˜ëœ ê²ƒì„ ì‚¬ìš©í•˜ì—¬ í”„ë¡œë¯¸ìŠ¤ë¥¼ ê³„ì† ì²´ì´ë‹(ì—°ê²°) í•  ìˆ˜ ìˆë‹¤.
    // ì½œë°± ì§€ì˜¥ë³´ë‹¤ ê°€ë…ì„±ì´ ì¢‹ê³  ê°„ê²°

    // í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹ ì˜ˆ1
    const myPromiseChain = new Promise((resolve, reject) => {
      resolve(); // ì‹¤ìŠµìš©ì´ë¼ ë°”ë¡œ ì„±ê³µ ì²˜ë¦¬
    });
    
    myPromiseChain
    .then(data => {
      console.log(data);
      return 'working...';
    })
    .then(data => {
      // ì´ì „ í”„ë¡œë¯¸ìŠ¤ì—ì„œ ë°›ì€ ê°’ì„ ì¶œë ¥
      console.log(data);
      throw new Error('failed! ğŸ†');
    })
    .catch(err => {
      // í”„ë¡œë¯¸ìŠ¤ ìˆ˜í–‰ ì¤‘ ë°œìƒí•œ ì˜¤ë¥˜ë¥¼ ë°›ì•„ì„œ ì¶œë ¥
      console.log(err);
    });

    // í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹ ì˜ˆ2
    // ì½œë°± ì§€ì˜¥ ì˜ˆì œ2ë¥¼ í”„ë¡œë¯¸ìŠ¤ë¡œ ë¦¬íŒ©í„°ë§ í•˜ê¸°
    const loginUser = (id, password) => {
      return new Promise((resolve, reject) => {
        // 2ì´ˆê°„ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í•˜ëŠ”ê²ƒì²˜ëŸ¼ ê¾¸ë°ˆ
        setTimeout(() => {
          if (id === 'chacha' && password === '1111') {
            // ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ìœ ì € ì •ë³´(ì—¬ê¸°ì„œëŠ” ê·¸ëƒ¥ id)ë¥¼ ì½œë°± í•¨ìˆ˜ì— ì „ë‹¬í•¨
            resolve(id);
          } else {
            reject(new Error('ì¡´ì¬í•˜ì§€ ì•ŠìŒ'));
          }
        }, 2000);
      });
    };

    const getRoles = (userId) => {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          if (userId === 'chacha') {
            // ê¶Œí•œì„ ê°€ì ¸ì˜¤ëŠ” ì‘ì—…ì„ í•˜ê³  ë°›ì•„ì˜¨ ê¶Œí•œ ì •ë³´ë¥¼ ì½œë°± í•¨ìˆ˜ì— ì „ë‹¬í•¨
            resolve({ name: 'chachacha', role: 'admin' });
          } else {
            reject(new Error('ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ'));
          }
        }, 1000);
      })
    };

    const id = prompt('ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    const password = prompt('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

    loginUser(id, password)
    .then(userId => { // ë¡œê·¸ì¸ì´ ì„±ê³µí•˜ë©´
      return getRoles(userId); // userId ê°’ì„ í†µí•´ ê¶Œí•œ ì •ë³´ë¥¼ ì–»ëŠ” getRoles() í˜¸ì¶œ
    })
    .then(roleInfo => { // ê¶Œí•œ ì •ë³´ë¥¼ ì–»ì–´ì˜¤ë©´
      alert(`Welcome ${roleInfo.name} (${roleInfo.role})`); // alertì— ì •ë³´ ë„ìš°ê¸°
    })
    .catch(err=> { // ì—ëŸ¬ í•¸ë“¤ë§
      console.error(err);
    });
  </script>
</body>
</html>