<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script>
    // 3. async / await (ES2017) - í”„ë¡œë¯¸ìŠ¤ ëŒ€ì²´ê°€ ì•„ë‹˜(ë¬¸ë²•ì  ì„¤íƒ•)
    // "í”„ë¡œë¯¸ìŠ¤ë¥¼ ìž‘ì„±í•˜ê¸° ì‰½ê²Œ ë§Œë“ ë‹¤."
    // ðŸ˜¶asyncëŠ”
    // - í•¨ìˆ˜ ì•žì— ë¶™ì´ëŠ” í‚¤ì›Œë“œ
    // - í•¨ìˆ˜ê°€ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•˜ë„ë¡ í•¨

    // ðŸ˜€awaitëŠ”
    // - í”„ë¡œë¯¸ìŠ¤ ì•žì— ë¶™ì´ëŠ” í‚¤ì›Œë“œ
    // - í•¨ìˆ˜ê°€ í”„ë¡œë¯¸ìŠ¤ë¥¼ ê¸°ë‹¤ë¦¬ê²Œ í•¨
    // - async í•¨ìˆ˜ ë‚´ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìžˆìŒ
    // - í•¨ìˆ˜ ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€í•˜ê³  í”„ë¡œë¯¸ìŠ¤ ê²°ê³¼(ì„±ê³µ or ì‹¤íŒ¨)ë¥¼ ê¸°ë‹¤ë¦¬ë„ë¡ í•¨

    // ë¹„ë™ê¸° í•¨ìˆ˜ ë§Œë“¤ì–´ë³´ê¸° ì˜ˆì œ
    // ì¼ë°˜ì ì¸ í•¨ìˆ˜
    function fetchData() {
      return new Promise((resolve, reject) => {
        // ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ìž‘ì—…...
        resolve('ë„¤ê°€ ì›í•˜ëŠ” ë°ì´í„°');
      });
    }

    fetchData().then(res => {
      console.log(res);
    });

    // ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ í•¨ìˆ˜ ì•žì— async í‚¤ì›Œë“œë¥¼ ë¶™ì´ë©´ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë§Œë“¤ì§€ ì•Šì•„ë„ ìžë™ìœ¼ë¡œ í”„ë¡œë¯¸ìŠ¤ë¡œ ë°˜í™˜ë¨
    async function fetchData2() {
        // ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ìž‘ì—…...
        return 'ë„¤ê°€ ì›í•˜ëŠ” ë°ì´í„°';
      };

    fetchData2().then(res => {
      console.log(res);
    });

    // 3-1. í”„ë¡œë¯¸ìŠ¤ then()ì„ ì‚¬ìš©í•œ ë°©ì‹ê³¼ async/awaitë¡œ ë¦¬íŒ©í„°ë§ í•˜ê¸°
    // ì˜ˆì œ 1
    function walk(amount) {
      return new Promise((resolve, reject) => {
        if (amount < 500) {
          reject('too small');
        }

        setTimeout(() => {
          resolve(`${amount}ms ë§Œí¼ ê±¸ìŒ`);
        }, amount);
      });
    }

    // walk(1000)
    // .then(res => {
    //   console.log(res);
    //   return walk(500);
    // })
    // .then(res => {
    //   console.log(res);
    //   return walk(700);
    // })
    // .then(res => {
    //   console.log(res);
    //   return walk(800);
    // })
    // .then(res => {
    //   console.log(res);
    //   return walk(200);
    // })
    // .catch(err => {
    //   console.error(err);
    // });

    // ì˜ˆì œ1 ë¦¬íŒ©í„°ë§
    async function go() {
      // í”„ë¡œë¯¸ìŠ¤ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤€ë‹¤
      let res = await walk(500); // 0.5ì´ˆ ê¸°ë‹¤ë¦¼
      console.log(res);
      res = await walk(900); // 0.9ì´ˆ ê¸°ë‹¤ë¦¼
      console.log(res);
      res = await walk(600); // 0.6ì´ˆ ê¸°ë‹¤ë¦¼
      console.log(res);
      res = await walk(1500); // 1.5ì´ˆ ê¸°ë‹¤ë¦¼
      console.log(res);
      res = await walk(200); // ì‹¤..íŒ¨.....
      console.log(res);
      console.log('finished');
      // awaitë¥¼ ì“°ë©´ ìš°ë¦¬ê°€ í‰ìƒì‹œ ì½”ë”©í•˜ëŠ” ê²ƒì²˜ã…“ã… ë™ê¸°ì  ì½”ë“œë¡œ ë³´ìž„(ê°€ë…ì„±)
    }
    go();

    // ì˜ˆì œ2
    // ê¹ƒí—ˆë¸Œ APIë¡œ íŠ¹ì • ì‚¬ìš©ìž ì •ë³´ ì¡°íšŒ
    fetch('https://api.github.com/users/hac0309')
      .then(res => {
        return res.json();
      })
      .then(res => {
        // ì„±ê³µ ì‹œ ë°ì´í„°ë¥¼ ì¶œë ¥
        console.log(res);
      })
      .catch(err => {
        // ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ì¶œë ¥
        console.error(err);
      });

    // ì˜ˆì œ2 async/awaitë¡œ ë¦¬íŒ©í„°ë§
    // Quiz
    const getGithubUserInfo =  async username => {
      try {
        const res = await fetch(`https://api.github.com/users/${username}`);
        const userInfo = await res.json();
        console.log(userInfo);
      } catch (err) {
        console.error(err);
      }
    };

    getGithubUserInfo('hac0309');

    // 3-2. ì˜¤ë¥˜ ì²˜ë¦¬
    // ì¼ë°˜ì ì¸ í”„ë¡œë¯¸ìŠ¤ì—ì„œëŠ” catch()ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œë¯¸ìŠ¤ê°€ ë°˜í™˜í•˜ëŠ” ì˜¤ë¥˜ë“¤ì„ ì²˜ë¦¬
    // async/awaitë„ ë¹„ìŠ· - try/catch êµ¬ë¬¸ ì‚¬ìš©
    function ayncFunc() {
      try {
        // ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥í•œ ì½”ë“œë“¤ì„ ì—¬ê¸°ì—..
        const response = fetch('api-url');
        console.log(response);
        // response ê°ì²´ë¥¼ ë°›ì•˜ë‹¤ê³  í•´ì„œ ë¬´ì¡°ê±´ ìš”ì²­ì´ ì„±ê³µí•œ ê²ƒì€ ì•„ë‹˜!!
        if (response.ok) {
          throw new Error(`${response.status} (${response.statusText})`);
        }
      } catch (err) {
        console.log(err);
      }
    }
    ayncFunc();

    // Quiz
    // ì•žì˜ í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹ ì˜ˆì œ2ë¥¼ 
    const loginUser = (id, password) => {
      return new Promise((resolve, reject) => {
        // 2ì´ˆê°„ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í•˜ëŠ”ê²ƒì²˜ëŸ¼ ê¾¸ë°ˆ
        setTimeout(() => {
          if (id === 'chacha' && password === '1111') {
            // ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ìœ ì € ì •ë³´(ì—¬ê¸°ì„œëŠ” ê·¸ëƒ¥ id)ë¥¼ ì½œë°± í•¨ìˆ˜ì— ì „ë‹¬í•¨
            resolve(id);
          } else {
            reject(new Error('ì¡´ìž¬í•˜ì§€ ì•ŠìŒ'));
          }
        }, 2000);
      });
    };

    const getRoles = (userId) => {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          if (userId === 'chacha') {
            // ê¶Œí•œì„ ê°€ì ¸ì˜¤ëŠ” ìž‘ì—…ì„ í•˜ê³  ë°›ì•„ì˜¨ ê¶Œí•œ ì •ë³´ë¥¼ ì½œë°± í•¨ìˆ˜ì— ì „ë‹¬í•¨
            resolve({ name: 'chachacha', role: 'admin' });
          } else {
            reject(new Error('ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ'));
          }
        }, 1000);
      })
    };

    const id = prompt('ì•„ì´ë””ë¥¼ ìž…ë ¥í•˜ì„¸ìš”.');
    const password = prompt('ë¹„ë°€ë²ˆí˜¸ë¥¼ ìž…ë ¥í•˜ì„¸ìš”.');

    // ížŒíŠ¸ : ê°€ìž¥ ë¨¼ì € async í•¨ìˆ˜ ë§Œë“¤ê¸°
    const loginAndGetRoles = async (id, password) => {
      try {
        const userId = await loginUser(id, password);
        const roleInfo = await getRoles(userId);
        await alert(`Welcome ${roleInfo.name} (${roleInfo.role})`);
      } catch (error) {
        console.error(error);
      }
    };
    loginAndGetRoles(id, password);

  </script>
</body>
</html>